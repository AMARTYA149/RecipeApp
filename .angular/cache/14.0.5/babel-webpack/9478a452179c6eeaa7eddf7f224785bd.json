{"ast":null,"code":"\"use strict\";\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar AngularUniversalModule_1;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AngularUniversalModule = void 0;\n\nconst common_1 = require(\"@angular/common\");\n\nconst common_2 = require(\"@nestjs/common\");\n\nconst core_1 = require(\"@nestjs/core\");\n\nconst fs_1 = require(\"fs\");\n\nconst path_1 = require(\"path\");\n\nrequire(\"reflect-metadata\");\n\nconst angular_universal_constants_1 = require(\"./angular-universal.constants\");\n\nconst angular_universal_providers_1 = require(\"./angular-universal.providers\");\n\nlet AngularUniversalModule = AngularUniversalModule_1 = class AngularUniversalModule {\n  constructor(ngOptions, httpAdapterHost) {\n    this.ngOptions = ngOptions;\n    this.httpAdapterHost = httpAdapterHost;\n  }\n\n  static forRoot(options) {\n    const indexHtml = (0, fs_1.existsSync)((0, path_1.join)(options.viewsPath, 'index.original.html')) ? 'index.original.html' : 'index';\n    options = Object.assign({\n      templatePath: indexHtml,\n      rootStaticPath: '*.*',\n      renderPath: '*'\n    }, options);\n    return {\n      module: AngularUniversalModule_1,\n      providers: [{\n        provide: angular_universal_constants_1.ANGULAR_UNIVERSAL_OPTIONS,\n        useValue: options\n      }]\n    };\n  }\n\n  onModuleInit() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.httpAdapterHost) {\n        return;\n      }\n\n      const httpAdapter = this.httpAdapterHost.httpAdapter;\n\n      if (!httpAdapter) {\n        return;\n      }\n\n      const app = httpAdapter.getInstance();\n      app.get(this.ngOptions.renderPath, (req, res) => res.render(this.ngOptions.templatePath, {\n        req,\n        res,\n        providers: [{\n          provide: common_1.APP_BASE_HREF,\n          useValue: req.baseUrl\n        }]\n      }));\n    });\n  }\n\n};\nAngularUniversalModule = AngularUniversalModule_1 = __decorate([(0, common_2.Module)({\n  providers: [...angular_universal_providers_1.angularUniversalProviders]\n}), __param(0, (0, common_2.Inject)(angular_universal_constants_1.ANGULAR_UNIVERSAL_OPTIONS)), __metadata(\"design:paramtypes\", [Object, core_1.HttpAdapterHost])], AngularUniversalModule);\nexports.AngularUniversalModule = AngularUniversalModule;","map":null,"metadata":{},"sourceType":"script"}